<div class="d-flex justify-content-between align-items-center mb-2">
  <h3 class="mb-0">Projekt Dateien</h3>
  <div class="btn-group">
    <button class="btn btn-outline-light btn-sm" [class.active]="!viewTrash" (click)="viewTrash=false; loadFiles()"><i class="bi bi-folder2"></i> Dateien</button>
    <button class="btn btn-outline-light btn-sm" [class.active]="viewTrash" (click)="viewTrash=true; loadFiles()"><i class="bi bi-trash"></i> Papierkorb</button>
    <button class="btn btn-outline-danger btn-sm" *ngIf="viewTrash" (click)="purgeTrash()"><i class="bi bi-x-octagon"></i> Papierkorb leeren</button>
  </div>
</div>
<!-- Ordner-Navigation -->
<div class="mb-3" *ngIf="!viewTrash">
  <div class="d-flex flex-wrap gap-2">
    <button class="btn btn-sm" [ngClass]="selectedFolderId==null ? 'btn-primary' : 'btn-outline-light'" (click)="selectedFolderId=null; page=1">
      <i class="bi bi-collection"></i> Alle
    </button>
    <button class="btn btn-sm" *ngFor="let fo of folders" [ngClass]="selectedFolderId===fo.id ? 'btn-primary' : 'btn-outline-light'" (click)="selectedFolderId=fo.id; page=1">
      <i class="bi bi-folder2"></i> {{ fo.name }}
    </button>
  </div>
  <div class="text-secondary small mt-1" *ngIf="selectedFolderId as fid">Angezeigt: {{ folderNameById(fid) }}</div>
  <div class="text-secondary small mt-1" *ngIf="selectedFolderId==null">Angezeigt: Alle Dateien</div>
</div>
<div class="row g-2 mb-3">
  <div class="col-md-6">
    <input class="form-control" placeholder="Suchen (Dateiname)" [(ngModel)]="q" (ngModelChange)="page=1">
  </div>
  <div class="col-md-3">
    <select class="form-select" [(ngModel)]="pageSize" (ngModelChange)="page=1">
      <option [ngValue]="10">10 pro Seite</option>
      <option [ngValue]="25">25 pro Seite</option>
      <option [ngValue]="50">50 pro Seite</option>
    </select>
  </div>
  <div class="col-md-3 text-end">
    <div class="btn-group" role="group">
      <button class="btn btn-outline-light" (click)="page=Math.max(1,page-1)" [disabled]="page<=1">Zurück</button>
      <span class="btn btn-outline-secondary disabled">Seite {{page}} / {{ totalPages }}</span>
      <button class="btn btn-outline-light" (click)="page=Math.min(totalPages,page+1)" [disabled]="page>=totalPages">Weiter</button>
    </div>
  </div>
  <div class="col-12" *ngIf="!viewTrash">
    <div class="input-group">
      <select class="form-select" [(ngModel)]="selectedFolderId">
        <option *ngFor="let fo of folders" [ngValue]="fo.id">{{ fo.name }}</option>
      </select>
      <input type="file" class="form-control" (change)="onFileSelected($event)">
    </div>
  </div>
</div>
<ul class="list-group">
  <li class="list-group-item bg-dark text-light border-secondary" *ngFor="let f of filteredFiles">
    <div class="d-flex justify-content-between align-items-center">
      <span>
        <i class="bi bi-file-earmark"></i>
        <ng-container *ngIf="!f._renaming; else rn">
          {{ f.original_name }}
          <small class="text-secondary" *ngIf="f.folder">[{{ folderNameById(f.folder) }}]</small>
        </ng-container>
        <ng-template #rn>
          <input class="form-control form-control-sm d-inline-block w-auto bg-dark text-light border-secondary" [(ngModel)]="f._newName">
          <button class="btn btn-sm btn-success ms-1" (click)="rename(f)"><i class="bi bi-check-lg"></i></button>
          <button class="btn btn-sm btn-outline-light ms-1" (click)="f._renaming=false"><i class="bi bi-x-lg"></i></button>
        </ng-template>
        <small class="text-secondary">({{ f.size }} B)</small>
      </span>
      <div class="btn-group btn-group-sm">
        <button class="btn btn-outline-light" (click)="download(f)"><i class="bi bi-download"></i></button>
        <label class="btn btn-outline-light mb-0" *ngIf="!viewTrash">
          <i class="bi bi-arrow-repeat"></i>
          <input type="file" class="d-none" (change)="replaceFile($event, f)">
        </label>
        <button class="btn btn-outline-light" (click)="openRenameModal(f)" *ngIf="!viewTrash"><i class="bi bi-pencil"></i></button>
        <button class="btn btn-outline-danger" (click)="remove(f)" *ngIf="!viewTrash"><i class="bi bi-trash"></i></button>
        <button class="btn btn-outline-success" (click)="restore(f)" *ngIf="viewTrash"><i class="bi bi-arrow-counterclockwise"></i></button>
        <button class="btn btn-outline-danger" (click)="purge(f)" *ngIf="viewTrash"><i class="bi bi-x-octagon"></i></button>
      </div>
    </div>
  </li>
</ul>

<!-- Rename Modal -->
<div class="modal fade" id="renameModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content bg-dark text-light border-secondary">
      <div class="modal-header">
        <h5 class="modal-title">Datei umbenennen</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Schließen"></button>
      </div>
      <div class="modal-body">
        <label class="form-label">Neuer Name</label>
        <input class="form-control" [(ngModel)]="renameName">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">Abbrechen</button>
        <button type="button" class="btn btn-primary" (click)="confirmRename()">Speichern</button>
      </div>
    </div>
  </div>
</div>
