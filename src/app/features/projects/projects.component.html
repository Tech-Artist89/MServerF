<div class="projects-container">
  <!-- Header Section -->
  <div class="page-header">
    <div class="header-content">
      <div class="page-title">
        <i class="bi" [ngClass]="pageIcon"></i>
        <h1>{{ pageTitle }}</h1>
      </div>
      <div class="header-controls">
        <button class="purge-all-btn" *ngIf="viewMode === 'trash'" (click)="purgeAllTrash()" title="Papierkorb komplett leeren">
          <i class="bi bi-x-octagon-fill"></i>
          <span>Papierkorb leeren</span>
        </button>
        <div class="search-box">
          <i class="bi bi-search"></i>
          <input class="form-control" placeholder="Suchen (Name/Beschreibung)" [(ngModel)]="q" (ngModelChange)="page=1">
        </div>
        <select class="form-select page-size" [(ngModel)]="pageSize" (ngModelChange)="page=1">
          <option [ngValue]="10">10 pro Seite</option>
          <option [ngValue]="25">25 pro Seite</option>
          <option [ngValue]="50">50 pro Seite</option>
        </select>
      </div>
    </div>
    
    <!-- Pagination -->
    <div class="pagination-wrapper">
      <div class="pagination-controls">
        <button class="btn-pagination" (click)="page=Math.max(1,page-1)" [disabled]="page<=1">
          <i class="bi bi-chevron-left"></i>
          <span>Zurück</span>
        </button>
        <div class="page-info">
          <span>Seite {{page}} von {{ totalPages }}</span>
        </div>
        <button class="btn-pagination" (click)="page=Math.min(totalPages,page+1)" [disabled]="page>=totalPages">
          <span>Weiter</span>
          <i class="bi bi-chevron-right"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Projects Grid -->
  <div class="projects-grid">
    <div class="project-card" *ngFor="let p of filteredProjects">
      <div class="project-header">
        <div class="project-icon">
          <i class="bi bi-folder-fill"></i>
        </div>
        <button class="favorite-btn" 
                [class.active]="p.is_favorite" 
                (click)="toggleFavorite(p)"
                title="{{ p.is_favorite ? 'Aus Favoriten entfernen' : 'Zu Favoriten hinzufügen' }}">
          <i class="bi" [ngClass]="p.is_favorite ? 'bi-star-fill' : 'bi-star'"></i>
        </button>
      </div>
      <div class="project-content">
        <h3 class="project-name">{{ p.name }}</h3>
        <p class="project-description">{{ p.description }}</p>
      </div>
      <div class="project-actions">
        <a [routerLink]="getProjectLink(p.id)" class="btn-primary" *ngIf="viewMode !== 'trash'">
          <i class="bi bi-folder2-open"></i>
          <span>Öffnen</span>
        </a>
        <button class="btn-secondary" (click)="restoreProject(p)" *ngIf="viewMode === 'trash'">
          <i class="bi bi-arrow-clockwise"></i>
          <span>Wiederherstellen</span>
        </button>
      </div>

      <!-- Deleted Files Section for Trash View -->
      <div class="deleted-files-section" *ngIf="viewMode === 'trash' && p.deleted_files?.length">
        <h4 class="deleted-files-title">
          <i class="bi bi-file-earmark-x"></i>
          Gelöschte Dateien ({{ p.deleted_files.length }})
        </h4>
        <div class="deleted-files-list">
          <div class="deleted-file-item" *ngFor="let file of p.deleted_files">
            <div class="file-info">
              <i class="bi bi-file-earmark"></i>
              <span class="file-name">{{ file.original_name }}</span>
              <small class="file-size">{{ formatFileSize(file.size) }}</small>
            </div>
            <button class="restore-file-btn" (click)="restoreFile(file)" title="Datei wiederherstellen">
              <i class="bi bi-arrow-counterclockwise"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
