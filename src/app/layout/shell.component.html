<div class="app-container d-flex min-vh-100">
  <!-- Left Navigation Panel (20%) -->
  <nav class="sidebar-nav">
    <div class="nav-brand">
      <i class="bi bi-hdd-stack text-primary"></i>
      <span>Mitra File Server</span>
    </div>
    
    <div class="nav-section">
      <ul class="nav-menu">
        <li class="nav-item">
          <a class="nav-link" routerLink="/projects" routerLinkActive="active">
            <i class="bi bi-folder2-open"></i>
            <span>Projekte</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" routerLink="/shared" routerLinkActive="active">
            <i class="bi bi-share"></i>
            <span>Shared</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" routerLink="/favorites" routerLinkActive="active">
            <i class="bi bi-star"></i>
            <span>Favoriten</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" routerLink="/trash" routerLinkActive="active">
            <i class="bi bi-trash"></i>
            <span>Papierkorb</span>
          </a>
        </li>
      </ul>

      <!-- Admin Section -->
      <div class="admin-section" *ngIf="(auth.me()?.is_staff) || (auth.me()?.profile?.role === 'admin')">
        <div class="admin-header" (click)="toggleAdminDropdown()">
          <i class="bi bi-gear-fill"></i>
          <span>Admin-Bereich</span>
          <i class="bi bi-chevron-down dropdown-icon" [class.rotated]="adminDropdownOpen"></i>
        </div>
        <ul class="admin-dropdown" [class.open]="adminDropdownOpen">
          <li><a class="dropdown-link" routerLink="/admin/users"><i class="bi bi-people"></i>Benutzer</a></li>
          <li><a class="dropdown-link" routerLink="/admin/companies"><i class="bi bi-building"></i>Firmen</a></li>
          <li><a class="dropdown-link" routerLink="/admin/projects"><i class="bi bi-briefcase"></i>Projekte</a></li>
          <li><a class="dropdown-link" routerLink="/admin/audit-logs"><i class="bi bi-journal-text"></i>Audit-Logs</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Main Content Area (55%) -->
  <main class="main-content">
    <div class="content-wrapper">
      <router-outlet></router-outlet>
    </div>
  </main>

  <!-- Right Info Panel (25%) -->
  <aside class="info-panel">
    <!-- Logout Button -->
    <div class="panel-header">
      <button class="btn-logout" (click)="auth.logout()" *ngIf="auth.isAuthenticated">
        <i class="bi bi-box-arrow-right"></i>
        <span>Logout</span>
      </button>
    </div>

    <!-- Storage Usage Section -->
    <div class="storage-section">
      <h5 class="section-title">
        <i class="bi bi-hdd"></i>
        Speicher-Nutzung
      </h5>
      <div class="storage-overview" *ngIf="storageStats">
        <div class="total-storage">
          <div class="storage-bar">
            <div class="storage-used" [style.width.%]="storageStats.usagePercentage"></div>
          </div>
          <div class="storage-text">
            <span class="used">{{ formatFileSize(storageStats.usedSize) }} verwendet</span>
            <span class="total">von {{ formatFileSize(storageStats.totalSize) }}</span>
          </div>
        </div>
      </div>

      <div class="storage-overview" *ngIf="!storageStats">
        <div class="loading-placeholder">
          <i class="bi bi-arrow-clockwise"></i>
          Lade Speicherdaten...
        </div>
      </div>

      <div class="storage-breakdown" *ngIf="storageStats">
        <div class="storage-item" *ngIf="storageStats.breakdown.images > 0">
          <div class="item-info">
            <i class="bi bi-image text-success"></i>
            <span class="item-name">Bilder</span>
          </div>
          <span class="item-size">{{ formatFileSize(storageStats.breakdown.images) }}</span>
        </div>
        <div class="storage-item" *ngIf="storageStats.breakdown.documents > 0">
          <div class="item-info">
            <i class="bi bi-file-text text-info"></i>
            <span class="item-name">Dokumente</span>
          </div>
          <span class="item-size">{{ formatFileSize(storageStats.breakdown.documents) }}</span>
        </div>
        <div class="storage-item" *ngIf="storageStats.breakdown.archives > 0">
          <div class="item-info">
            <i class="bi bi-file-zip text-warning"></i>
            <span class="item-name">Archive</span>
          </div>
          <span class="item-size">{{ formatFileSize(storageStats.breakdown.archives) }}</span>
        </div>
        <div class="storage-item" *ngIf="storageStats.breakdown.media > 0">
          <div class="item-info">
            <i class="bi bi-camera-video text-primary"></i>
            <span class="item-name">Medien</span>
          </div>
          <span class="item-size">{{ formatFileSize(storageStats.breakdown.media) }}</span>
        </div>
        <div class="storage-item" *ngIf="storageStats.breakdown.trash > 0">
          <div class="item-info">
            <i class="bi bi-trash text-danger"></i>
            <span class="item-name">Papierkorb</span>
          </div>
          <span class="item-size">{{ formatFileSize(storageStats.breakdown.trash) }}</span>
        </div>
        <div class="storage-item" *ngIf="storageStats.breakdown.other > 0">
          <div class="item-info">
            <i class="bi bi-file-earmark text-secondary"></i>
            <span class="item-name">Andere</span>
          </div>
          <span class="item-size">{{ formatFileSize(storageStats.breakdown.other) }}</span>
        </div>
      </div>
    </div>

    <!-- Upload Progress Section -->
    <div class="upload-section">
      <h5 class="section-title">
        <i class="bi bi-cloud-upload"></i>
        Upload-Status
      </h5>

      <!-- Active uploads -->
      <div class="upload-queue" *ngIf="activeUploads && activeUploads.length > 0">
        <div class="upload-item" *ngFor="let upload of activeUploads">
          <div class="upload-info">
            <i class="bi" [ngClass]="getUploadIcon(upload.fileType)"></i>
            <span class="upload-name">{{ upload.fileName }}</span>
            <button class="cancel-upload"
                    *ngIf="upload.status === 'uploading' || upload.status === 'pending'"
                    (click)="cancelUpload(upload.id)"
                    title="Upload abbrechen">
              <i class="bi bi-x"></i>
            </button>
          </div>
          <div class="upload-progress">
            <div class="progress-bar">
              <div class="progress-fill"
                   [ngClass]="{
                     'completed': upload.status === 'completed',
                     'error': upload.status === 'error'
                   }"
                   [style.width.%]="upload.progress"></div>
            </div>
            <span class="progress-text">
              <ng-container [ngSwitch]="upload.status">
                <span *ngSwitchCase="'completed'">✓</span>
                <span *ngSwitchCase="'error'" title="{{ upload.errorMessage }}">⚠</span>
                <span *ngSwitchCase="'pending'">Warteschlange</span>
                <span *ngSwitchDefault>{{ upload.progress }}%</span>
              </ng-container>
            </span>
          </div>
        </div>
      </div>

      <!-- No uploads message -->
      <div class="no-uploads" *ngIf="!activeUploads || activeUploads.length === 0">
        <div class="empty-state">
          <i class="bi bi-cloud-upload"></i>
          <span>Keine aktiven Uploads</span>
        </div>
      </div>
    </div>
  </aside>

  <app-toasts></app-toasts>
</div>
